define("brix/animation/constant",[],function(){return{BX_ANIMATION_HOOK:"bx-animation",BX_ANIMATION_NAMESPACE:"."+(Math.random()+"").replace(/\D/g,"")}}),define("brix/animation/compatEventName",["jquery","underscore"],function(a,b){var c="transitionend",d="animationend",e="transition",f="animation";return"ontransitionend"in window||("onwebkittransitionend"in window?(c+=" webkitTransitionEnd",e="webkitTransition"):("onotransitionend"in dom.tNode||"Opera"===navigator.appName)&&(c+=" oTransitionEnd",e="oTransition")),"onanimationend"in window||("onwebkitanimationend"in window?(d+=" webkitAnimationEnd",f="webkitAnimation"):"onoanimationend"in dom.tNode&&(d+=" oAnimationEnd",f="oAnimation")),{transitionEnd:c,animationEnd:d,transitionProperty:e,animationProperty:f}}),define("brix/animation/registCommand",["jquery","underscore","./allDomEvents","./compatEventName","./constant"],function(a,b,c,d,e){function f(){var f,g=this,h=[];g.register("on",function(d){var i=d.param,j=d.node,k=d.done,l=d.index,m=a(document.body),n=i+e.BX_ANIMATION_NAMESPACE;c.indexOf(i)>-1&&(m.on(n,"["+e.BX_ANIMATION_HOOK+"]",function(a){j[0]===a.currentTarget&&(clearTimeout(f),console.log(h),h.forEach(function(a,b){j.removeClass(a)}),h=[],k(l,a))}),-1===b.indexOf(g._delegateEvents,n)&&g._delegateEvents.push(n))}),g.register("execute",function(b,c){var d=a.trim(b.param),e=(b.node,b.done),f=g.options.owner,h=/([^\(\)]+)(\(.+\))?/,i=h.exec(d),j=i[1],k=a.trim(/\((.+)\)/.exec(i[2])[1]).split(/\s*\,\s*/);k.unshift(c),h?(f[j]&&f[j].apply(f,k),e()):e()}),g.register("emit",function(a){var b=a.param,c=(a.node,a.done);g._customEmits[b].done(),c()}),g.register("class",function(a){function b(a){i||(i=!0,"2"!==k&&(f.removeClass(j),h.splice(h.indexOf(j),1)),g())}var c=a.param,f=a.node,g=a.done,i=!1,j=c.split(",")[0],k=c.split(",")[1];f.addClass(j),h.push(j),f.off(d.animationEnd+e.BX_ANIMATION_NAMESPACE),f.off(d.transitionEnd+e.BX_ANIMATION_NAMESPACE),"3"===k?g():(f.on(d.animationEnd+e.BX_ANIMATION_NAMESPACE,b),f.on(d.transitionEnd+e.BX_ANIMATION_NAMESPACE,b))}),g.register("wait",function(a){var b=(a.node,a.param),c=a.done;f=setTimeout(function(){c()},b)}),g.register("style",function(c){function f(a){l||(l=!0,"2"!==g&&b.each(k,function(a,b){h.css(a.name,"")}),i())}var g,h=c.node,i=c.done,j=c.param.split(","),k=[],l=!1;/\s+/.test(a.trim(j[j.length-1]))||(g=a.trim(j.pop())),b.each(j,function(b,c){b=a.trim(b);var d=b.split(/\s+/);k.push({name:d.shift(),value:d.join(" ")})}),b.each(k,function(a,b){h.css(a.name,a.value)}),h.off(d.animationEnd+e.BX_ANIMATION_NAMESPACE),h.off(d.transitionEnd+e.BX_ANIMATION_NAMESPACE),"3"===g?i():(h.on(d.transitionEnd+e.BX_ANIMATION_NAMESPACE,f),h.on(d.animationEnd+e.BX_ANIMATION_NAMESPACE,f))})}return f}),define("brix/animation/allDomEvents",[],function(){var a,b=document.createElement("div"),c=[];for(a in b)/^on/.test(a)&&c.push(a.slice(2));return c}),define("brix/animation/initAnimation",["./allDomEvents","./constant"],function(a,b){function c(c){function d(a,b){var d=$.trim(a),f=$.trim(d.split(":")[0]),g=$.trim(d.split(":")[1]),h={command:f,node:c,index:b,param:g,done:function(a,c){var d=a||b;e(++d,c)}};return h}function e(a,b){if(a>g.length-1)return void(a=0);var c=d(g[a],a),e=f._builtinCommands[c.command];if(!e)throw c.command+" 该命令未定义";setTimeout(function(){e(c,b)},0)}var f=this,g=c.attr(b.BX_ANIMATION_HOOK).split(";");""===$.trim(g[g.length-1])&&g.pop(),g.forEach(function(b,c){var e=d(b,c);"on"===e.command&&-1===a.indexOf(e.param)&&(f._customEmits[e.param]=e)}),e(0)}return c}),define("brix/animation",["jquery","underscore","./animation/compatEventName","./animation/registCommand","./animation/allDomEvents","./animation/initAnimation","./animation/constant"],function(a,b,c,d,e,f,g){function h(c){var e=this;this.options=a.extend(!0,{el:"body",owner:{}},c),this._builtinCommands={},this._customEmits={},this._delegateEvents=[],d.call(e);var h=a(e.options.el).find("["+g.BX_ANIMATION_HOOK+"]");b.each(h,function(b,c){f.call(e,a(b))})}return h.prototype={destroy:function(){b.each(this._delegateEvents,function(b){a(document.body).off(b)})},register:function(a,b){this._builtinCommands[a]=b}},h});