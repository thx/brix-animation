define("brix/compatEventName",[],function(){var n="transitionend",t="animationend",e="transition",i="animation";try{var a=a}catch(o){a=null}return"ontransitionend"in window||("onwebkittransitionend"in window?(n+=" webkitTransitionEnd",e="webkitTransition"):(a&&a.tNode&&"onotransitionend"in a.tNode||"Opera"===navigator.appName)&&(n+=" oTransitionEnd",e="oTransition")),"onanimationend"in window||("onwebkitanimationend"in window?(t+=" webkitAnimationEnd",i="webkitAnimation"):a&&a.tNode&&"onoanimationend"in a.tNode&&(t+=" oAnimationEnd",i="oAnimation")),{transitionEnd:n,animationEnd:t,transitionProperty:e,animationProperty:i}}),define("brix/constant",[],function(){return{BX_ANIMATION_HOOK:"bx-animation"}}),define("brix/extendCommand",["jquery","./compatEventName","./constant"],function($,compatEventName,Constant){function extendCommand(Animation){Animation.extend("on",function(n){var t=n.param.split(","),e=t[0].trim(),i=t[1]&&t[1].trim(),a=n.node,o=n.done,s=n.index,d=$(document.body),m=e+n.instance._eventNamespace;d.on(m,"["+Constant.BX_ANIMATION_HOOK+"]",function(n){if(a[0]===n.currentTarget){if("2"===i&&a.isAnimating)return;clearTimeout(a.waitItv),console.log("addedClass",a.addedClass),a.addedClass&&a.addedClass.forEach(function(n,t){a.removeClass(n)}),a.addedClass=[],console.log("addedStyles",a.addedStyles),a.addedStyles&&a.addedStyles.forEach(function(n,t){a.css(n.name,"")}),a.addedStyles=[],a.isAnimating=!1,o(n,s)}}),n.instance._delegateEvents.indexOf(m)===-1&&n.instance._delegateEvents.push(m)}),Animation.extend("execute",function(step,event){var param=step.param.trim(),node=step.node,done=step.done,owner=step.instance.options.owner,parseExecuteReg=/([^\(\)]+)(\(.+\))?/,execute=parseExecuteReg.exec(param),func=execute[1],params=[];if(node.isAnimating=!0,execute[2]&&(params=eval("(["+/\((.+)\)/.exec(execute[2])[1].trim()+"])")),event=event||{},event.node=node,params.unshift(event),parseExecuteReg){if(!owner[func])throw"方法："+func+"不存在";var isStop=owner[func].apply(owner,params);"object"==typeof isStop&&isStop.then?isStop.then(function(n){n!==!1&&(done(event),node.isAnimating=!1)}):isStop!==!1&&(done(event),node.isAnimating=!1)}else done(event),node.isAnimating=!1}),Animation.extend("call",function(n,t){var e=n.param,i=(n.node,n.done),a=e.split(",");a.forEach(function(t){t=t.trim();var e=n.instance._customEmits[t]||[];e.forEach(function(n){n.done()})}),i(t)}),Animation.extend("class",function(n,t){function e(n){a.isAnimating&&("2"!==m&&(a.removeClass(d),a.addedClass.splice(a.addedClass.indexOf(d),1)),o(t),a.isAnimating=!1)}var i=n.param,a=n.node,o=n.done,s=n.instance._eventNamespace,d=i.split(",")[0].trim(),m=(i.split(",")[1]||"1").trim();a.addClass(d),a.addedClass?a.addedClass.push(d):a.addedClass=[d],a.off(compatEventName.animationEnd+s),a.off(compatEventName.transitionEnd+s),a.isAnimating=!0,"3"===m?(o(t),a.isAnimating=!1):(a.on(compatEventName.animationEnd+s,e),a.on(compatEventName.transitionEnd+s,e))}),Animation.extend("removeClass",function(n,t){function e(n){a.isAnimating&&(o(t),a.isAnimating=!1)}var i=n.param,a=n.node,o=n.done,s=n.instance._eventNamespace,d=i.split(",")[0].trim(),m=(i.split(",")[1]||"1").trim();a.removeClass(d),a.off(compatEventName.animationEnd+s),a.off(compatEventName.transitionEnd+s),a.isAnimating=!0,"3"===m?(o(t),a.isAnimating=!1):(a.on(compatEventName.animationEnd+s,e),a.on(compatEventName.transitionEnd+s,e))}),Animation.extend("style",function(n,t){function e(n){i.isAnimating&&("2"!==d&&i.addedStyles.forEach(function(n,t){i.css(n.name,"")}),a(t),i.isAnimating=!1)}var i=n.node,a=n.done,o=n.param.split(","),s=n.instance._eventNamespace,d="1";i.addedStyles=i.addedStyles||[],i.isAnimating=!1,/\s+/.test(o[o.length-1].trim())||(d=o.pop().trim()),o.forEach(function(n,t){n=n.trim();var e=n.split(/\s+/);i.addedStyles.push({name:e.shift(),value:e.join(" ")})}),i.addedStyles.forEach(function(n,t){i.css(n.name,n.value)}),i.off(compatEventName.animationEnd+s),i.off(compatEventName.transitionEnd+s),"3"===d?(a(t),i.isAnimating=!1):(i.on(compatEventName.transitionEnd+s,e),i.on(compatEventName.animationEnd+s,e))}),Animation.extend("wait",function(n,t){var e=n.node,i=n.param,a=n.done;e.isAnimating=!0,e.waitItv=setTimeout(function(){a(t),e.isAnimating=!1},i)})}return extendCommand}),define("brix/initAnimation",["./constant"],function(n){function t(t,e){function i(n,t){var i=n.trim(),s=/^([^:]+)\:(.+)$/.exec(i);if(!s||!s[1]||!s[2])return console.error("命令格式错误，参考格式： on:click; execute:dosomething(); class:tada;");var d=s[1].trim(),m=s[2].trim(),r={instance:o,command:d,node:e,index:t,param:m,done:function(n,e){var i=e||t;a(++i,n)}};return r}function a(n,e){if(n>s.length-1)return void(n=0);var a=i(s[n],n),o=t._builtinCommands[a.command],d=["when"],m=d.indexOf(a.command)>-1;if(!o&&!m)throw a.command+" 该命令未定义";if(!m)if(a.node.isAnimating)var r=setInterval(function(){a.node.isAnimating||(clearInterval(r),o(a,e))},10);else o(a,e)}var o=this,s=e.attr(n.BX_ANIMATION_HOOK).split(";");""===s[s.length-1].trim()&&s.pop(),s.forEach(function(n,e){var a=i(n,e);if("when"===a.command&&(a.instance._customEmits[a.param]?a.instance._customEmits[a.param].push(a):a.instance._customEmits[a.param]=[a]),"on"===a.command){var o=t._builtinCommands[a.command];o(a)}}),a(0)}return t}),define("brix/animation",["jquery","./extendCommand","./initAnimation","./constant"],function(n,t,e,i){function a(n){var o=this;this.options=$.extend(!0,{el:$("body"),owner:{}},n),this._customEmits={},this._delegateEvents=[],this._eventNamespace="."+(Math.random()+"").replace(/\D/g,""),t(a);var s=$(o.options.el).find("["+i.BX_ANIMATION_HOOK+"]");s.each(function(n,t){e.call(o,a,$(t))})}return a._builtinCommands={},a.extend=function(n,t){a._builtinCommands[n]=t},a.prototype={destroy:function(){this._delegateEvents.forEach(function(n,t){$(document.body).off(n)})}},a});