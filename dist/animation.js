define("brix/compatEventName",[],function(){var n="transitionend",t="animationend",i="transition",e="animation";try{var a=a}catch(o){a=null}return"ontransitionend"in window||("onwebkittransitionend"in window?(n+=" webkitTransitionEnd",i="webkitTransition"):(a&&a.tNode&&"onotransitionend"in a.tNode||"Opera"===navigator.appName)&&(n+=" oTransitionEnd",i="oTransition")),"onanimationend"in window||("onwebkitanimationend"in window?(t+=" webkitAnimationEnd",e="webkitAnimation"):a&&a.tNode&&"onoanimationend"in a.tNode&&(t+=" oAnimationEnd",e="oAnimation")),{transitionEnd:n,animationEnd:t,transitionProperty:i,animationProperty:e}}),define("brix/constant",[],function(){return{BX_ANIMATION_HOOK:"bx-animation"}}),define("brix/extendCommand",["jquery","./compatEventName","./constant"],function($,compatEventName,Constant){function extendCommand(Animation){Animation.extend("on",function(n){var t=n.param.split(","),i=t[0].trim(),e=n.node,a=n.done,o=n.index,m=$(document.body),s=i+n.instance._eventNamespace;m.on(s,"["+Constant.BX_ANIMATION_HOOK+"]",function(n){if(e[0]===n.currentTarget){if(e.isAnimating)return;a(n,o)}}),n.instance._delegateEvents.indexOf(s)===-1&&n.instance._delegateEvents.push(s)}),Animation.extend("execute",function(step,event){var param=step.param.trim(),node=step.node,done=step.done,owner=step.instance.options.owner,parseExecuteReg=/([^\(\)]+)(\(.+\))?/,execute=parseExecuteReg.exec(param),func=execute[1],params=[];if(node.isAnimating=!0,execute[2]&&(params=eval("(["+/\((.+)\)/.exec(execute[2])[1].trim()+"])")),event=event||{},event.node=node,params.unshift(event),parseExecuteReg){if(!owner[func])throw"方法："+func+"不存在";var isStop=owner[func].apply(owner,params);"object"==typeof isStop&&isStop.then?isStop.then(function(n){n!==!1&&(node.isAnimating=!1,done(event))}):isStop!==!1&&(node.isAnimating=!1,done(event))}else node.isAnimating=!1,done(event)}),Animation.extend("call",function(n,t){var i=n.param,e=(n.node,n.done),a=i.split(",");a.forEach(function(t){t=t.trim();var i=n.instance._customEmits[t]||[];i.forEach(function(n){n.done()})}),e(t)}),Animation.extend("class",function(n,t){function i(n){a.isAnimating&&("2"!==r&&a.removeClass(s),a.isAnimating=!1,o(t))}var e=n.param,a=n.node,o=n.done,m=n.instance._eventNamespace,s=e.split(",")[0].trim(),r=(e.split(",")[1]||"1").trim();a.addClass(s),a.off(compatEventName.animationEnd+m),a.off(compatEventName.transitionEnd+m),a.isAnimating=!0,"3"===r?(a.isAnimating=!1,o(t)):(a.on(compatEventName.animationEnd+m,i),a.on(compatEventName.transitionEnd+m,i))}),Animation.extend("removeClass",function(n,t){function i(n){a.isAnimating&&(a.isAnimating=!1,o(t))}var e=n.param,a=n.node,o=n.done,m=n.instance._eventNamespace,s=e.split(",")[0].trim(),r=(e.split(",")[1]||"1").trim();a.removeClass(s),a.off(compatEventName.animationEnd+m),a.off(compatEventName.transitionEnd+m),a.isAnimating=!0,"3"===r?(a.isAnimating=!1,o(t)):(a.on(compatEventName.animationEnd+m,i),a.on(compatEventName.transitionEnd+m,i))}),Animation.extend("style",function(n,t){function i(n){e.isAnimating&&("2"!==s&&r.forEach(function(n,t){e.css(n.name,"")}),e.isAnimating=!1,a(t))}var e=n.node,a=n.done,o=n.param.split(","),m=n.instance._eventNamespace,s="1",r=[];e.isAnimating=!0,/\s+/.test(o[o.length-1].trim())||(s=o.pop().trim()),o.forEach(function(n,t){n=n.trim();var i=n.split(/\s+/);r.push({name:i.shift(),value:i.join(" ")})}),r.forEach(function(n,t){e.css(n.name,n.value)}),e.off(compatEventName.animationEnd+m),e.off(compatEventName.transitionEnd+m),"3"===s?(e.isAnimating=!1,a(t)):(e.on(compatEventName.transitionEnd+m,i),e.on(compatEventName.animationEnd+m,i))}),Animation.extend("wait",function(n,t){var i=n.node,e=n.param,a=n.done;i.isAnimating=!0,i.waitItv=setTimeout(function(){i.isAnimating=!1,a(t)},e)})}return extendCommand}),define("brix/initAnimation",["./constant"],function(n){function t(t,i){function e(n,t){var e=n.trim(),m=/^([^:]+)\:(.+)$/.exec(e);if(!m||!m[1]||!m[2])return console.error("命令格式错误，参考格式： on:click; execute:dosomething(); class:tada;");var s=m[1].trim(),r=m[2].trim(),c={instance:o,command:s,node:i,index:t,param:r,done:function(n,i){var e=i||t;a(++e,n)}};return c}function a(n,i){if(n>m.length-1)return void(n=0);var a=e(m[n],n),o=t._builtinCommands[a.command],s=["when","on"],r=s.indexOf(a.command)>-1;if(!o&&!r)throw a.command+" 该命令未定义";if(!r)if(a.node.isAnimating)var c=setInterval(function(){a.node.isAnimating||(clearInterval(c),o(a,i))},10);else o(a,i)}var o=this,m=i.attr(n.BX_ANIMATION_HOOK).split(";");""===m[m.length-1].trim()&&m.pop(),m.forEach(function(n,i){var a=e(n,i);if("when"===a.command&&(a.instance._customEmits[a.param]?a.instance._customEmits[a.param].push(a):a.instance._customEmits[a.param]=[a]),"on"===a.command){var o=t._builtinCommands[a.command];o(a)}}),a(0)}return t}),define("brix/animation",["jquery","./extendCommand","./initAnimation","./constant"],function(n,t,i,e){function a(n){var o=this;this.options=$.extend(!0,{el:$("body"),owner:{}},n),this._customEmits={},this._delegateEvents=[],this._eventNamespace="."+(Math.random()+"").replace(/\D/g,""),t(a);var m=$(o.options.el).find("["+e.BX_ANIMATION_HOOK+"]");m.each(function(n,t){i.call(o,a,$(t))})}return a._builtinCommands={},a.extend=function(n,t){a._builtinCommands[n]=t},a.prototype={destroy:function(){this._delegateEvents.forEach(function(n,t){$(document.body).off(n)})}},a});