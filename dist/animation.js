define("brix/animation/util",[],function(){var n="transitionend",i="animationend",t="transition",e="animation";try{var a=a}catch(o){a=null}return"ontransitionend"in window||("onwebkittransitionend"in window?(n+=" webkitTransitionEnd",t="webkitTransition"):(a&&a.tNode&&"onotransitionend"in a.tNode||"Opera"===navigator.appName)&&(n+=" oTransitionEnd",t="oTransition")),"onanimationend"in window||("onwebkitanimationend"in window?(i+=" webkitAnimationEnd",e="webkitAnimation"):a&&a.tNode&&"onoanimationend"in a.tNode&&(i+=" oAnimationEnd",e="oAnimation")),{transitionEnd:n,animationEnd:i,transitionProperty:t,animationProperty:e,BX_ANIMATION_HOOK:"bx-animation"}}),define("brix/animation/commands",["jquery","./util"],function($,util){function extendCommand(Animation){Animation.extend("on",function(n){var i=n.param.split(","),t=i[0].trim(),e=n.node,a=n.done,o=n.index,s=$(document.body),m=t+n.instance._eventNamespace;s.on(m,"["+util.BX_ANIMATION_HOOK+"]",function(n){if(e[0]===n.currentTarget){if(e.isAnimating)return;a(n,o)}}),n.instance._delegateEvents.indexOf(m)===-1&&n.instance._delegateEvents.push(m)}),Animation.extend("execute",function(step,event){var param=step.param.trim(),node=step.node,done=step.done,owner=step.instance.options.owner,parseExecuteReg=/([^\(\)]+)(\(.+\))?/,execute=parseExecuteReg.exec(param),func=execute[1],params=[];if(node.isAnimating=!0,execute[2]&&(params=eval("(["+/\((.+)\)/.exec(execute[2])[1].trim()+"])")),event=event||{},event.node=node,params.unshift(event),parseExecuteReg){if(!owner[func])throw"方法："+func+"不存在";var isStop=owner[func].apply(owner,params);"object"==typeof isStop&&isStop.then?isStop.then(function(n){n!==!1&&(node.isAnimating=!1,done(event))}):isStop!==!1&&(node.isAnimating=!1,done(event))}else node.isAnimating=!1,done(event)}),Animation.extend("call",function(n,i){var t=n.param,e=(n.node,n.done),a=t.split(",");a.forEach(function(i){i=i.trim();var t=n.instance._customEmits[i]||[];t.forEach(function(n){n.done()})}),e(i)}),Animation.extend("class",function(n,i){function t(n){a.isAnimating&&("2"!==r&&a.removeClass(m),a.isAnimating=!1,o(i))}var e=n.param,a=n.node,o=n.done,s=n.instance._eventNamespace,m=e.split(",")[0].trim(),r=(e.split(",")[1]||"1").trim();a.addClass(m),a.off(util.animationEnd+s),a.off(util.transitionEnd+s),a.isAnimating=!0,"3"===r?(a.isAnimating=!1,o(i)):(a.on(util.animationEnd+s,t),a.on(util.transitionEnd+s,t))}),Animation.extend("removeClass",function(n,i){function t(n){a.isAnimating&&(a.isAnimating=!1,o(i))}var e=n.param,a=n.node,o=n.done,s=n.instance._eventNamespace,m=e.split(",")[0].trim(),r=(e.split(",")[1]||"1").trim();a.removeClass(m),a.off(util.animationEnd+s),a.off(util.transitionEnd+s),a.isAnimating=!0,"3"===r?(a.isAnimating=!1,o(i)):(a.on(util.animationEnd+s,t),a.on(util.transitionEnd+s,t))}),Animation.extend("style",function(n,i){function t(n){e.isAnimating&&("2"!==m&&r.forEach(function(n,i){e.css(n.name,"")}),e.isAnimating=!1,a(i))}var e=n.node,a=n.done,o=n.param.split(","),s=n.instance._eventNamespace,m="1",r=[];e.isAnimating=!0,/\s+/.test(o[o.length-1].trim())||(m=o.pop().trim()),o.forEach(function(n,i){n=n.trim();var t=n.split(/\s+/);r.push({name:t.shift(),value:t.join(" ")})}),r.forEach(function(n,i){e.css(n.name,n.value)}),e.off(util.animationEnd+s),e.off(util.transitionEnd+s),"3"===m?(e.isAnimating=!1,a(i)):(e.on(util.transitionEnd+s,t),e.on(util.animationEnd+s,t))}),Animation.extend("wait",function(n,i){var t=n.node,e=n.param,a=n.done;t.isAnimating=!0,t.waitItv=setTimeout(function(){t.isAnimating=!1,a(i)},e)})}return extendCommand}),define("brix/animation/parse",["./util"],function(n){function i(i,t){function e(n,i){var e=n.trim(),s=/^([^:]+)\:(.+)$/.exec(e);if(!s||!s[1]||!s[2])return console.error("命令格式错误，参考格式： on:click; execute:dosomething(); class:tada;");var m=s[1].trim(),r=s[2].trim(),d={instance:o,command:m,node:t,index:i,param:r,done:function(n,t){var e=t||i;a(++e,n)}};return d}function a(n,t){if(n>s.length-1)return void(n=0);var a=e(s[n],n),o=i._builtinCommands[a.command],m=["when","on"],r=m.indexOf(a.command)>-1;if(!o&&!r)throw a.command+" 该命令未定义";if(!r)if(a.node.isAnimating)var d=setInterval(function(){a.node.isAnimating||(clearInterval(d),o(a,t))},10);else o(a,t)}var o=this,s=t.attr(n.BX_ANIMATION_HOOK).split(";");""===s[s.length-1].trim()&&s.pop(),s.forEach(function(n,t){var a=e(n,t);if("when"===a.command&&(a.instance._customEmits[a.param]?a.instance._customEmits[a.param].push(a):a.instance._customEmits[a.param]=[a]),"on"===a.command){var o=i._builtinCommands[a.command];o(a)}}),a(0)}return i}),define("brix/animation",["jquery","./animation/commands","./animation/parse","./animation/util"],function(n,i,t,e){function a(o){var s=this;this.options=n.extend(!0,{el:n("body"),owner:{}},o),this._customEmits={},this._delegateEvents=[],this._eventNamespace="."+(Math.random()+"").replace(/\D/g,""),i(a);var m=n(s.options.el).find("["+e.BX_ANIMATION_HOOK+"]");m.each(function(i,e){t.call(s,a,n(e))})}return a._builtinCommands={},a.extend=function(n,i){a._builtinCommands[n]=i},a.prototype={destroy:function(){this._delegateEvents.forEach(function(i,t){n(document.body).off(i)})}},a});