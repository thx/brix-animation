define("brix/compatEventName",["jquery","underscore"],function(n,t){var e="transitionend",i="animationend",a="transition",o="animation";try{var s=s}catch(m){s=null}return"ontransitionend"in window||("onwebkittransitionend"in window?(e+=" webkitTransitionEnd",a="webkitTransition"):(s&&s.tNode&&"onotransitionend"in s.tNode||"Opera"===navigator.appName)&&(e+=" oTransitionEnd",a="oTransition")),"onanimationend"in window||("onwebkitanimationend"in window?(i+=" webkitAnimationEnd",o="webkitAnimation"):s&&s.tNode&&"onoanimationend"in s.tNode&&(i+=" oAnimationEnd",o="oAnimation")),{transitionEnd:e,animationEnd:i,transitionProperty:a,animationProperty:o}}),define("brix/constant",[],function(){return{BX_ANIMATION_HOOK:"bx-animation"}}),define("brix/extendCommand",["jquery","underscore","./compatEventName","./constant"],function($,_,compatEventName,Constant){function extendCommand(Animation){var addedClass=[],waitItv;Animation.extend("on",function(n){var t=n.param,e=n.node,i=n.done,a=n.index,o=$(document.body),s=t+n.instance._eventNamespace;o.on(s,"["+Constant.BX_ANIMATION_HOOK+"]",function(n){e[0]===n.currentTarget&&(clearTimeout(waitItv),console.log(addedClass),_.each(addedClass,function(n){e.removeClass(n)}),addedClass=[],i(n,a))}),_.indexOf(n.instance._delegateEvents,s)===-1&&n.instance._delegateEvents.push(s)}),Animation.extend("execute",function(step,event){var param=$.trim(step.param),node=step.node,done=step.done,owner=step.instance.options.owner,parseExecuteReg=/([^\(\)]+)(\(.+\))?/,execute=parseExecuteReg.exec(param),func=execute[1],params=[];if(node.isAnimating=!0,execute[2]&&(params=$.trim(/\((.+)\)/.exec(execute[2])[1]).split(/\s*\,\s*/)),_.each(params,function(item,i){try{params[i]=eval("("+item+")")}catch(err){throw"execute传参格式错误: "+err.message}}),event=event||{},event.node=node,params.unshift(event),parseExecuteReg){if(!owner[func])throw"方法："+func+"不存在";var isStop=owner[func].apply(owner,params);_.isObject(isStop)&&isStop.then&&isStop.fail&&isStop.done?isStop.then(function(n){n!==!1&&(done(event),node.isAnimating=!1)}):isStop!==!1&&(done(event),node.isAnimating=!1)}else done(event),node.isAnimating=!1}),Animation.extend("call",function(n,t){var e=n.param,i=(n.node,n.done),a=_.map(e.split(","),function(n){return $.trim(n)});_.each(a,function(t){_.each(n.instance._customEmits[t],function(n){n.done()})}),i(t)}),Animation.extend("class",function(n,t){function e(n){m||(m=!0,"2"!==d&&(a.removeClass(r),addedClass.splice(addedClass.indexOf(r),1)),o(t),a.isAnimating=!1)}var i=n.param,a=n.node,o=n.done,s=n.instance._eventNamespace,m=!1,r=i.split(",")[0],d=i.split(",")[1]||"1";a.addClass(r),addedClass.push(r),a.off(compatEventName.animationEnd+s),a.off(compatEventName.transitionEnd+s),a.isAnimating=!0,"3"===d?(o(t),a.isAnimating=!1):(a.on(compatEventName.animationEnd+s,e),a.on(compatEventName.transitionEnd+s,e))}),Animation.extend("wait",function(n,t){var e=n.node,i=n.param,a=n.done;e.isAnimating=!0,waitItv=setTimeout(function(){a(t),e.isAnimating=!1},i)}),Animation.extend("style",function(n,t){function e(n){d||(d=!0,"2"!==r&&_.each(s,function(n,t){i.css(n.name,"")}),a(t),i.isAnimating=!1)}var i=n.node,a=n.done,o=n.param.split(","),s=[],m=n.instance._eventNamespace,r="1",d=!1;i.isAnimating=!1,/\s+/.test($.trim(o[o.length-1]))||(r=$.trim(o.pop())),_.each(o,function(n,t){n=$.trim(n);var e=n.split(/\s+/);s.push({name:e.shift(),value:e.join(" ")})}),_.each(s,function(n,t){i.css(n.name,n.value)}),i.off(compatEventName.animationEnd+m),i.off(compatEventName.transitionEnd+m),"3"===r?(a(t),i.isAnimating=!1):(i.on(compatEventName.transitionEnd+m,e),i.on(compatEventName.animationEnd+m,e))})}return extendCommand}),define("brix/initAnimation",["./constant"],function(n){function t(t,e){function i(n,t){var i=$.trim(n),s=/^([^:]+)\:(.+)$/.exec(i);if(!s||!s[1]||!s[2])throw"命令格式错误，参考格式： on:click; execute:dosomething(); class:tada;";var m=$.trim(s[1]),r=$.trim(s[2]),d={instance:o,command:m,node:e,index:t,param:r,done:function(n,e){var i=e||t;a(++i,n)}};return d}function a(n,e){if(n>s.length-1)return void(n=0);var a=i(s[n],n),o=t._builtinCommands[a.command],m=["when"],r=$.inArray(a.command,m)>-1;if(!o&&!r)throw a.command+" 该命令未定义";if(!r)if(a.node.isAnimating)var d=setInterval(function(){a.node.isAnimating||(clearInterval(d),o(a,e))},10);else o(a,e)}var o=this,s=e.attr(n.BX_ANIMATION_HOOK).split(";");""===$.trim(s[s.length-1])&&s.pop(),_.each(s,function(n,t){var e=i(n,t);"when"===e.command&&(e.instance._customEmits[e.param]?e.instance._customEmits[e.param].push(e):e.instance._customEmits[e.param]=[e])}),a(0)}return t}),define("brix/animation",["jquery","underscore","./extendCommand","./initAnimation","./constant"],function(n,t,e,i,a){function o(s){var m=this;this.options=n.extend(!0,{el:n("body"),owner:{}},s),this._customEmits={},this._delegateEvents=[],this._eventNamespace="."+(Math.random()+"").replace(/\D/g,""),e(o);var r=n(m.options.el).find("["+a.BX_ANIMATION_HOOK+"]");t.each(r,function(t,e){i.call(m,o,n(t))})}return o._builtinCommands={},o.extend=function(n,t){o._builtinCommands[n]=t},o.prototype={destroy:function(){t.each(this._delegateEvents,function(t){n(document.body).off(t)})}},o});